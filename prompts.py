"""
–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è RAG —Å–∏—Å—Ç–µ–º—ã.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–∞ –∏–ª–∏ –æ–±—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
FEATURE_DESCRIPTION_PROMPT = """–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º –∏ –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –≥–µ–æ–ª–æ–≥–∏–∏ –ö–∞—Å–ø–∏–π—Å–∫–æ–≥–æ –º–æ—Ä—è.

–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑–Ω–∞–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "R0", "–°–æ—Ä–≥", "–ø–æ—Ä–∏—Å—Ç–æ—Å—Ç—å", "–≥–ª—É–±–∏–Ω–∞" –∏ —Ç.–¥.), 
   —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞, –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –≥–µ–æ–ª–æ–≥–∏–∏.

2. –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ —Ö–æ—á–µ—Ç –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.

–í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤."""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–∏–∑–Ω–∞–∫ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
FEATURE_MATCH_PROMPT = """–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º.

–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_name}"
–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_description}"

–û–ø—Ä–µ–¥–µ–ª–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —ç—Ç–æ—Ç –ø—Ä–∏–∑–Ω–∞–∫ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –æ–¥–Ω–æ —Å–ª–æ–≤–æ:
- "–î–ê" - –µ—Å–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—Å—É
- "–ù–ï–¢" - –µ—Å–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—Å—É

–ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏–∫–∞–∫–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ "–î–ê" –∏–ª–∏ "–ù–ï–¢"."""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞
SQL_GENERATION_PROMPT = """–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CSV —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ DuckDB.

–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ù–∞–π–¥–µ–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—Å—É:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_name}"
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_description}"

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã df (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏):
{columns_info}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π! –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
2. –ö–û–ü–ò–†–£–ô –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –¢–û–ß–ù–û –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ - –±—É–∫–≤–∞ –≤ –±—É–∫–≤—É, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
3. –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏, –∑–∞–ø—è—Ç—ã–º–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫–ª—é—á–∞–π –≤ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
4. –î–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏: '–∑–Ω–∞—á–µ–Ω–∏–µ'
5. –ë—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω –∫ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö: —á–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è —Å—Ä–∞–≤–Ω–∏–≤–∞–π –∫–∞–∫ —á–∏—Å–ª–∞, —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏
6. –ï—Å–ª–∏ –≤ –∑–∞–ø—Ä–æ—Å–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É, –∏—Å–ø–æ–ª—å–∑—É–π –æ–ø–µ—Ä–∞—Ç–æ—Ä LIKE
7. –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏:
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "R0 > 1.0%" –∏–ª–∏ "R0 > 1.0", –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–ª–æ–Ω–∫—É "R–æ,%" –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å —á–∏—Å–ª–æ–º –ë–ï–ó —Å–∏–º–≤–æ–ª–∞ %: "R–æ,%" > 1.0
   - –ü—Ä–æ—Ü–µ–Ω—Ç—ã –≤ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è, –≤ SQL –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∞ NULL: "R–æ,%" > 1.0 AND "R–æ,%" IS NOT NULL
8. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û SQL –∑–∞–ø—Ä–æ—Å –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
9. –ù–∞—á–∏–Ω–∞–π –∑–∞–ø—Ä–æ—Å —Å SELECT –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è —Ç–∞–±–ª–∏—Ü—ã 'df'
10. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å DuckDB/SQLite

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø GROUP BY:
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (MAX, MIN, AVG, SUM, COUNT), –í–°–ï –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ SELECT –î–û–õ–ñ–ù–´ –±—ã—Ç—å –≤ GROUP BY
- –ù–∞–ø—Ä–∏–º–µ—Ä: SELECT MAX("–°–æ—Ä–≥") AS max_corg, "lon", "lat", "–†–µ–≥–∏–æ–Ω" FROM df WHERE "–°–æ—Ä–≥" IS NOT NULL GROUP BY "lon", "lat", "–†–µ–≥–∏–æ–Ω" ORDER BY max_corg DESC LIMIT 10
- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: SELECT MAX("–°–æ—Ä–≥") AS max_corg, "lon", "lat" FROM df WHERE "–°–æ—Ä–≥" IS NOT NULL ORDER BY max_corg DESC - —ç—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É "column lon must appear in the GROUP BY clause"!
- –ï—Å–ª–∏ –≤—ã–±–∏—Ä–∞–µ—à—å "lon" –∏ "lat" –≤ SELECT –≤–º–µ—Å—Ç–µ —Å –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –æ–Ω–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GROUP BY
- –ï—Å–ª–∏ –≤—ã–±–∏—Ä–∞–µ—à—å –¥—Ä—É–≥–∏–µ –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–†–µ–≥–∏–æ–Ω", "–°–≤–∏—Ç–∞", "–ü–ª–∞—Å—Ç"), –æ–Ω–∏ —Ç–æ–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GROUP BY
- –ü–†–ê–í–ò–õ–û: –ö–∞–∂–¥–∞—è –∫–æ–ª–æ–Ω–∫–∞ –≤ SELECT, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –∞–≥—Ä–µ–≥–∞—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –î–û–õ–ñ–ù–ê –±—ã—Ç—å –≤ GROUP BY

–í–ê–ñ–ù–û: 
- –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–æ–µ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü–µ df —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫—É "{feature_name}"
- –ï—Å–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫ –∏–º–µ–µ—Ç —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–æ–Ω–∫—É –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "lon" –∏ "lat" –≤ SELECT, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MAX/MIN/AVG –¥–ª—è –ø—Ä–∏–∑–Ω–∞–∫–∞, –≤–∫–ª—é—á–∞–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è –≤ GROUP BY
- –£—á–∏—Ç—ã–≤–∞–π —É—Å–ª–æ–≤–∏—è –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü–†–ê–í–ò–õ–¨–ù–´–ï –ø—Ä–∏–º–µ—Ä—ã:
- SELECT MAX("–°–æ—Ä–≥,%") AS max_corg, "lon", "lat", "–†–µ–≥–∏–æ–Ω" FROM df WHERE "–°–æ—Ä–≥,%" IS NOT NULL GROUP BY "lon", "lat", "–†–µ–≥–∏–æ–Ω" ORDER BY max_corg DESC LIMIT 10
- SELECT "R–æ,%", "lon", "lat", "layer_name" FROM df WHERE "R–æ,%" > 1.0 AND "R–æ,%" IS NOT NULL LIMIT 10
- SELECT "–°–æ—Ä–≥,%", "lon", "lat" FROM df WHERE "–°–æ—Ä–≥,%" IS NOT NULL ORDER BY "–°–æ—Ä–≥,%" DESC LIMIT 1

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π SQL –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è –¢–û–ß–ù–´–ï —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ:"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–∞ —Å –æ—à–∏–±–∫–æ–π
SQL_FIX_PROMPT = """–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CSV —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ DuckDB.

–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ù–∞–π–¥–µ–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—Å—É:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_name}"
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_description}"

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã df (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏):
{columns_info}

–ü–†–ï–î–´–î–£–©–ò–ô SQL –ó–ê–ü–†–û–° (—Å –æ—à–∏–±–∫–æ–π):
{sql_query}

–û–®–ò–ë–ö–ê –ü–†–ò –í–´–ü–û–õ–ù–ï–ù–ò–ò:
{error_message}

–î–û–°–¢–£–ü–ù–´–ï –ö–û–õ–û–ù–ö–ò –ò–ó –û–®–ò–ë–ö–ò (–∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —ç—Ç–∏ –∏–º–µ–Ω–∞, –µ—Å–ª–∏ –æ–Ω–∏ —É–∫–∞–∑–∞–Ω—ã):
{candidate_bindings}

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –∏—Å–ø—Ä–∞–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å, —É—Å—Ç—Ä–∞–Ω–∏–≤ –æ—à–∏–±–∫—É.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π! –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
2. –ö–û–ü–ò–†–£–ô –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –¢–û–ß–ù–û –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ - –±—É–∫–≤–∞ –≤ –±—É–∫–≤—É, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
3. –ï—Å–ª–∏ –≤ –æ—à–∏–±–∫–µ —É–∫–∞–∑–∞–Ω—ã "–î–û–°–¢–£–ü–ù–´–ï –ö–û–õ–û–ù–ö–ò –ò–ó –û–®–ò–ë–ö–ò" - –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö –∏–º–µ–Ω, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ –µ–≥–æ –±—É–∫–≤–∞ –≤ –±—É–∫–≤—É
4. –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏, –∑–∞–ø—è—Ç—ã–º–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫–ª—é—á–∞–π –≤ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
5. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å GROUP BY - —É–±–µ–¥–∏—Å—å, —á—Ç–æ –í–°–ï –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ SELECT –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ GROUP BY
6. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∏–º–µ–Ω–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫ - –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∏–º–µ–Ω–∞ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—ã—à–µ –∏–ª–∏ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏–∑ –æ—à–∏–±–∫–∏
7. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—à—å —á–∏—Å–ª–∞ —Å —á–∏—Å–ª–∞–º–∏, —Å—Ç—Ä–æ–∫–∏ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
8. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
9. –ù–∞—á–∏–Ω–∞–π –∑–∞–ø—Ä–æ—Å —Å SELECT –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è —Ç–∞–±–ª–∏—Ü—ã 'df'
10. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å DuckDB/SQLite

–í–ê–ñ–ù–û: 
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—à–∏–±–∫—É –∏ –∏—Å–ø—Ä–∞–≤—å –∏–º–µ–Ω–Ω–æ —Ç—É –ø—Ä–æ–±–ª–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—à–∏–±–∫–µ
- –ï—Å–ª–∏ –≤ –æ—à–∏–±–∫–µ —É–∫–∞–∑–∞–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ –∏–º—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –°–æ—Ö—Ä–∞–Ω–∏ –ª–æ–≥–∏–∫—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –Ω–æ –∏—Å–ø—Ä–∞–≤—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "lon" –∏ "lat" –≤ SELECT, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MAX/MIN/AVG, –≤—Å–µ –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–≤–∫–ª—é—á–∞—è "lon" –∏ "lat") –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GROUP BY
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç "column X must appear in the GROUP BY clause" - –¥–æ–±–∞–≤—å —ç—Ç—É –∫–æ–ª–æ–Ω–∫—É –≤ GROUP BY
- –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–†–ò–ú–ï–†: SELECT MAX("–°–æ—Ä–≥") AS max_corg, "lon", "lat" FROM df WHERE "–°–æ—Ä–≥" IS NOT NULL GROUP BY "lon", "lat" ORDER BY max_corg DESC

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å:"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–∞ (—Ç—Ä–µ—Ç–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏)
SQL_FIX_PROMPT_V2 = """–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –Ω–∞–ø–∏—Å–∞–Ω–∏—é SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CSV —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ DuckDB.

–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ù–∞–π–¥–µ–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—Å—É:
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_name}"
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∞: "{feature_description}"

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã df (–¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏):
{columns_info}

–ü–†–ï–î–´–î–£–©–ò–ô SQL –ó–ê–ü–†–û–° (—Å –æ—à–∏–±–∫–æ–π):
{sql_query}

–û–®–ò–ë–ö–ê –ü–†–ò –í–´–ü–û–õ–ù–ï–ù–ò–ò:
{error_message}

–ò–°–¢–û–†–ò–Ø –û–®–ò–ë–û–ö:
{error_history}

–î–û–°–¢–£–ü–ù–´–ï –ö–û–õ–û–ù–ö–ò –ò–ó –û–®–ò–ë–ö–ò (–∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û –æ–¥–Ω–æ –∏–∑ —ç—Ç–∏—Ö –∏–º–µ–Ω, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ –µ–≥–æ –±—É–∫–≤–∞ –≤ –±—É–∫–≤—É):
{candidate_bindings}

–≠—Ç–æ –¢–†–ï–¢–¨–Ø –∏ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–∞. –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–≤–µ–Ω—á–∞–ª–∏—Å—å —É—Å–ø–µ—Ö–æ–º.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –≤—Å–µ –æ—à–∏–±–∫–∏ –∏ —Å–æ–∑–¥–∞—Ç—å –†–ê–ë–û–¢–ê–Æ–©–ò–ô SQL –∑–∞–ø—Ä–æ—Å.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π! –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ä—É—Å—Å–∫–∏–µ –∏–º–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ
2. –ö–û–ü–ò–†–£–ô –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –¢–û–ß–ù–û –∏–∑ —Å–ø–∏—Å–∫–∞ –≤—ã—à–µ - –±—É–∫–≤–∞ –≤ –±—É–∫–≤—É, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
3. –ï–°–õ–ò –≤ —Ä–∞–∑–¥–µ–ª–µ "–î–û–°–¢–£–ü–ù–´–ï –ö–û–õ–û–ù–ö–ò –ò–ó –û–®–ò–ë–ö–ò" —É–∫–∞–∑–∞–Ω—ã –∏–º–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–≤ –∏–º—è –ø–æ–ª–Ω–æ—Å—Ç—å—é (–≤–∫–ª—é—á–∞—è –≤—Å–µ —Å–∏–º–≤–æ–ª—ã, –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ)
4. –ù–ï –¥–æ–±–∞–≤–ª—è–π –∫ –∏–º–µ–Ω–∞–º –∫–æ–ª–æ–Ω–æ–∫ —Å–∏–º–≤–æ–ª—ã %, –∑–∞–ø—è—Ç—ã–µ –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∏–º–µ–Ω–∏
5. –ò–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏, –∑–∞–ø—è—Ç—ã–º–∏ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫–ª—é—á–∞–π –≤ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
6. –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–£–ô –í–°–ï –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ - –æ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
7. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å GROUP BY - —É–±–µ–¥–∏—Å—å, —á—Ç–æ –í–°–ï –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ SELECT –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ GROUP BY
8. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∏–º–µ–Ω–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫ - –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥–æ–µ –∏–º—è –∫–æ–ª–æ–Ω–∫–∏ —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—ã—à–µ –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è –∏–∑ "–î–û–°–¢–£–ü–ù–´–ï –ö–û–õ–û–ù–ö–ò –ò–ó –û–®–ò–ë–ö–ò"
9. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—à—å —á–∏—Å–ª–∞ —Å —á–∏—Å–ª–∞–º–∏, —Å—Ç—Ä–æ–∫–∏ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
10. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º - –∏—Å–ø–æ–ª—å–∑—É–π –ü–†–û–°–¢–û–ô –∏ –ü–†–ê–í–ò–õ–¨–ù–´–ô SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
11. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
12. –ù–∞—á–∏–Ω–∞–π –∑–∞–ø—Ä–æ—Å —Å SELECT –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∏–º—è —Ç–∞–±–ª–∏—Ü—ã 'df'
13. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å DuckDB/SQLite

–°–¢–†–ê–¢–ï–ì–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
- –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –ø–æ–ø—Ä–æ–±—É–π –£–ü–†–û–°–¢–ò–¢–¨ –∑–∞–ø—Ä–æ—Å
- –£–±–µ—Ä–∏ —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ SQL –æ–ø–µ—Ä–∞—Ü–∏–∏: SELECT, FROM, WHERE, ORDER BY, LIMIT
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —É–±–µ–¥–∏—Å—å —á—Ç–æ GROUP BY —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
- –ï—Å–ª–∏ –≤ –æ—à–∏–±–∫–µ —É–∫–∞–∑–∞–Ω—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ - –í–´–ë–ï–†–ò –û–î–ù–£ –∏–∑ –Ω–∏—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —ç—Ç–æ –∏–º—è (—Å–∫–æ–ø–∏—Ä—É–π –ø–æ–ª–Ω–æ—Å—Ç—å—é)
- –ü—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥–æ–µ –∏–º—è –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –≤—ã—à–µ –∏–ª–∏ —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏–∑ –æ—à–∏–±–∫–∏

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –î–õ–Ø GROUP BY –ò –ê–ì–†–ï–ì–ê–¢–ù–´–• –§–£–ù–ö–¶–ò–ô:
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MAX(), MIN(), AVG(), SUM(), COUNT() - –í–°–ï –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ SELECT –î–û–õ–ñ–ù–´ –±—ã—Ç—å –≤ GROUP BY
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç "column X must appear in the GROUP BY clause" - –¥–æ–±–∞–≤—å —ç—Ç—É –∫–æ–ª–æ–Ω–∫—É –≤ GROUP BY
- –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "lon" –∏ "lat" –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ SELECT —Å –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ - –æ–Ω–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GROUP BY
- –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–µ –≤–∞–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π ANY_VALUE("lon") –∏ ANY_VALUE("lat") –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ "lon" –∏ "lat"
- –ü–†–ê–í–ò–õ–¨–ù–´–ô –ü–†–ò–ú–ï–†: SELECT MAX("–°–æ—Ä–≥") AS max_corg, "lon", "lat" FROM df WHERE "–°–æ—Ä–≥" IS NOT NULL GROUP BY "lon", "lat" ORDER BY max_corg DESC LIMIT 10
- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: SELECT MAX("–°–æ—Ä–≥") AS max_corg, "lon", "lat" FROM df WHERE "–°–æ—Ä–≥" IS NOT NULL ORDER BY max_corg DESC - —ç—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É GROUP BY!

–í–ê–ñ–ù–û: 
- –≠—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –∑–∞–ø—Ä–æ—Å –î–û–õ–ñ–ï–ù —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –í–°–ï –æ—à–∏–±–∫–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤—å –∏—Ö –í–°–ï
- –°–æ—Ö—Ä–∞–Ω–∏ –ª–æ–≥–∏–∫—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –Ω–æ –∏—Å–ø—Ä–∞–≤—å –í–°–ï —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã "lon" –∏ "lat" –≤ SELECT, –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å MAX/MIN/AVG, –≤—Å–µ –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (–≤–∫–ª—é—á–∞—è "lon" –∏ "lat") –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ GROUP BY

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL –∑–∞–ø—Ä–æ—Å (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Ä–∞–±–æ—á–∏–π):"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤ (—Ä–æ–ª—å: –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å)
FINAL_SUMMARY_PROMPT = """–¢—ã - –æ–ø—ã—Ç–Ω—ã–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≤ –∏–Ω—Å—Ç–∏—Ç—É—Ç–µ –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –≥–µ–æ–ª–æ–≥–∏–∏, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ö–∞—Å–ø–∏–π—Å–∫–æ–≥–æ –º–æ—Ä—è.

–ò—Å—Ö–æ–¥–Ω—ã–π –≤–æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞: "{user_query}"

–ù–∞–π–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã:
{retrieved_data}

{coordinates_section}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ò –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–¨ –î–ê–ù–ù–´–•:
1. –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏—Å—Ö–æ–¥–Ω—ã–π –≤–æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–∏, –ö–ê–ö–ò–ï –ò–ú–ï–ù–ù–û –ø–∞—Ä–∞–º–µ—Ç—Ä—ã/–ø—Ä–∏–∑–Ω–∞–∫–∏ –æ–Ω —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç
2. –í –æ—Ç–≤–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ù–ê–ü–†–Ø–ú–£–Æ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –≤–æ–ø—Ä–æ—Å—É —Å—Ç—É–¥–µ–Ω—Ç–∞
3. –ù–ï –≤–∫–ª—é—á–∞–π –≤ –æ—Ç–≤–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö/–ø—Ä–∏–∑–Ω–∞–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å –≤ –≤–æ–ø—Ä–æ—Å–µ
4. –ù–∞–ø—Ä–∏–º–µ—Ä: 
   - –ï—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ "R0" –∏–ª–∏ "R–æ,%" - –ù–ï —É–ø–æ–º–∏–Ω–∞–π –∑–Ω–∞—á–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ì–∞—É—Å—Å, –°–æ—Ä–≥ –∏ —Ç.–¥.), –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω—ã
   - –ï—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ "–°–æ—Ä–≥" - –ù–ï —É–ø–æ–º–∏–Ω–∞–π R0, –ì–∞—É—Å—Å –∏ –¥—Ä—É–≥–∏–µ –Ω–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –ï—Å–ª–∏ —Å—Ç—É–¥–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∏—Ö
5. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–Ω–µ —É–ø–æ–º—è–Ω—É—Ç—ã–º–∏ –≤ –≤–æ–ø—Ä–æ—Å–µ) - –ò–ì–ù–û–†–ò–†–£–ô –∏—Ö –≤ –æ—Ç–≤–µ—Ç–µ
6. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —Ç–æ–º, —á—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç - –Ω–µ –¥–æ–±–∞–≤–ª—è–π "–ª–∏—à–Ω–µ–π" –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥—Ä—É–≥–∏—Ö –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –¥–∞—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π:
1. –ü—Ä—è–º–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –¢–û–õ–¨–ö–û —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lon, lat) –¥–ª—è –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!
3. –û–±—ä—è—Å–Ω—è–µ—Ç –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. –ü–æ–º–æ–≥–∞–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—É –ø–æ–Ω—è—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –≥–µ–æ–ª–æ–≥–∏–∏
5. –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞–∂–Ω—ã–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
6. –î–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –∏–∑—É—á–µ–Ω–∏—é —Ç–µ–º—ã, –µ—Å–ª–∏ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ö–û–û–†–î–ò–ù–ê–¢–´:
- –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lon, lat), –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∂–∏ –∏—Ö –≤ –æ—Ç–≤–µ—Ç–µ
- –§–æ—Ä–º–∞—Ç: "üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –î–æ–ª–≥–æ—Ç–∞: [–∑–Ω–∞—á–µ–Ω–∏–µ], –®–∏—Ä–æ—Ç–∞: [–∑–Ω–∞—á–µ–Ω–∏–µ]"
- –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ, –ø–µ—Ä–µ—á–∏—Å–ª–∏ –í–°–ï –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã - —ç—Ç–æ –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∏—Ö –Ω–µ–ª—å–∑—è –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å!

–ü–†–û–í–ï–†–¨ –ü–ï–†–ï–î –û–¢–í–ï–¢–û–ú:
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –º–æ–π –æ—Ç–≤–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤–æ–ø—Ä–æ—Å—É —Å—Ç—É–¥–µ–Ω—Ç–∞?
- –ù–µ—Ç –ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö/–ø—Ä–∏–∑–Ω–∞–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —É–ø–æ–º–∏–Ω–∞–ª–∏—Å—å –≤ –≤–æ–ø—Ä–æ—Å–µ?
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª–∏ —è —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤?

–ë—É–¥—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è—Ö. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –≥–µ–æ–ª–æ–≥–∏–∏, –Ω–æ –æ–±—ä—è—Å–Ω—è–π —Å–ª–æ–∂–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è.

–í–µ—Ä–Ω–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –≤–∫–ª—é—á–∞—è –¢–û–õ–¨–ö–û —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:"""

